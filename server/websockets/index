#! usr/bin/env node

/** Websockets */
function websockets(io){

    io.on('connection', socket => {

        var id = socket.handshake.query.id;
        console.log('user_id', id)
        
        socket.join(id);
        
        
        console.log('websockets', 'connected');
        socket.emit('message', { username: 'Server',type: 'server', message: 'Mensaje autom√°tico del servidor', timestamp: Date()});

        socket.on('message', function(data) {
            
            console.log('websockets', data);
            data.timestamp = new Date();
            io.to(data.toId).emit('message', data);

        });
        
    });

}

module.exports = websockets;